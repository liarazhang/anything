C51 COMPILER V9.01   XIAOCC                                                                09/14/2017 13:46:10 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE XIAOCC
OBJECT MODULE PLACED IN xiaocc.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE xiaocc.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg51.h>
   2          #include <intrins.h>
   3          #define uchar unsigned char
   4          #define uint unsigned int
   5          uchar data v=4;                      //电机转速0~5
   6          uchar data zhuan=0;                      //转弯标志
   7          uchar data t=0;                          //计时参数     
   8          sbit IN1 =P1^3;
   9          sbit IN2=P1^5;
  10          sbit IN3=P1^2;
  11          sbit IN4=P1^0;
  12          sbit ENA=P1^4;
  13          sbit ENB=P1^1;                   
  14          
  15          
  16          
  17          
  18          void Timer1() interrupt 3
  19          {
  20   1              TH1=0XFC;       //给定时器赋初值，定时1ms
  21   1              TL1=0X18;
  22   1                      t++;                                             //每一毫秒t2加一
  23   1              if(t==6)t=0;                             //六毫秒为一周期为电机和数码管延时
  24   1              if(P3&0X01)zhuan=2;                      //左侧探头探测到黑线
  25   1              if(P3&0X10)zhuan=1;                      //右侧探头探测到黑线
  26   1      }
  27          
  28          void stop()
  29          {
  30   1              IN1=0; 
  31   1              IN2=0;
  32   1              IN3=0;
  33   1              IN4=0;
  34   1              ENA=0;
  35   1              ENB=0;
  36   1      }               
  37          void qianjin()
  38          {
  39   1      if(t<=(v+1))
  40   1      {
  41   2              IN1=0;
  42   2              IN2=1;
  43   2              IN3=1;
  44   2              IN4=0;
  45   2              ENA=1;
  46   2              ENB=1;
  47   2              }
  48   1              else stop();
  49   1      }               
  50          void you()
  51          {
  52   1      if(t<=v)
  53   1      {
  54   2              IN1=0;
  55   2              IN2=1;
C51 COMPILER V9.01   XIAOCC                                                                09/14/2017 13:46:10 PAGE 2   

  56   2              IN3=1;
  57   2              IN4=0;
  58   2              ENA=0;
  59   2              ENB=1;
  60   2                      }
  61   1              else stop();
  62   1      }       
  63          
  64          void youman()
  65          {
  66   1      if(t<=(v-1))
  67   1      {
  68   2              IN1=0;
  69   2              IN2=1;
  70   2              IN3=1;
  71   2              IN4=0;
  72   2              ENA=0;
  73   2              ENB=1;
  74   2                      }
  75   1              else stop();
  76   1      }
  77          
  78          void zuo()
  79          {
  80   1      if(t<=v)
  81   1      {
  82   2              IN1=0;
  83   2              IN2=1;
  84   2              IN3=0;
  85   2              IN4=0;
  86   2              ENA=1;
  87   2              ENB=0;  
  88   2              }
  89   1              else stop();
  90   1      }       
  91          void zuoman()
  92          {
  93   1      if(t<=(v-1))
  94   1      {
  95   2              IN1=0;
  96   2              IN2=1;
  97   2              IN3=0;
  98   2              IN4=0;
  99   2              ENA=1;
 100   2              ENB=0;  
 101   2              }
 102   1              else stop();
 103   1      }
 104          void youyuan()
 105          {        if(t<=v)
 106   1      {
 107   2              IN1=1;
 108   2              IN2=0;
 109   2              IN3=1;
 110   2              IN4=0;
 111   2              ENA=1;
 112   2              ENB=1;  }
 113   1              else stop();
 114   1      }       
 115          void zuoyuan()
 116          {         if(t<=v)      {
 117   2              IN1=0;
C51 COMPILER V9.01   XIAOCC                                                                09/14/2017 13:46:10 PAGE 3   

 118   2              IN2=1;
 119   2              IN3=0;
 120   2              IN4=1;
 121   2              ENA=1;
 122   2              ENB=1;  }
 123   1              else stop();
 124   1      }       
 125          
 126          void main()
 127          {
 128   1      TMOD|=0X10;//选择为定时器1模式，工作方式1，仅用TR1打开启动。
 129   1      
 130   1              TH1=0XFC;       //给定时器赋初值，定时1ms
 131   1              TL1=0X18;       
 132   1              ET1=1;//打开定时器1中断允许
 133   1              EA=1;//打开总中断
 134   1              TR1=1;//打开定时器                      
 135   1          while(1)                                                                                                                       
 136   1              {         if(P3==0XE2||P3==0XE3||P3==0XF2||P3==0XFC)you();//右转
 137   2                  else if(P3==0xE6||P3==0xE7)youman();
 138   2                      else if(P3==0XE8||P3==0XE9||P3==0XF8||P3==0xFC)zuo();//左转
 139   2                      else if(P3==0xEC||P3==0xED)zuoman();
 140   2                      else if(P3==0XF0)zuoyuan();         //向左原地转弯
 141   2                      else if(P3==0XE1)youyuan();         //向右原地转弯
 142   2                      else if(P3==0XFF)stop();        //停止
 143   2                      else if(P3==0XE0&&zhuan==1)zuoyuan();//如果之前左侧探头检测到轨道则向左原地转弯
 144   2                      else if(P3==0XE0&&zhuan==2)youyuan();//如果之前右侧探头检测到轨道则向右原地转弯
 145   2                      else qianjin();                     //前进
 146   2              }
 147   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    406    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
