C51 COMPILER V9.01   WU                                                                    09/11/2017 10:50:49 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE WU
OBJECT MODULE PLACED IN wu.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE wu.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg52.h>
   2          #define uchar unsigned char
   3          #define uint unsigned int
   4          
   5          #define m0 1//ºÚÏßm1,°×Ïßm0
   6          #define m1 0
   7                     
   8          #define full_speed_left 40 //·½±ãµ÷½Ú¸÷¸ö×´Ì¬µÄÕ¼¿Õ±È ,¿ÉÓÃ²ÎÊý×é£º£¨30,35,6,25,30,68000,27000,500£©£»
   9          #define full_speed_right 45     //                                                                      £¨40,45,6,25,30,68000,27000,500£©£»
  10          #define correct_speed 6 //Ð£ÕýÊ±µÄµÍËÙÂÖµÄÕ¼¿Õ±È
  11          #define turn_speed_left 25
  12          #define turn_speed_right 30     
  13          #define lenth 68000             //²âÊÔÊý¾Ý£º10000--¡·100--¡·500--¡·2000--80000--76000--68000
  14          #define width 27000             //500--¡·10-->2000--¡·60000--30000---¡·27000
  15          #define check_right 500 //2000--¡·20--¡·200--¡·500
  16          #define midl left1
  17          #define midr right5 
  18          
  19          uchar Duty_left,Duty_right,i=0,j=0; //×óÓÒÕ¼¿Õ±È±êÖ¾£¬È¡1--100 
  20                          
  21          sbit IN1=P1^3;  
  22          sbit IN2=P1^5;  
  23          sbit IN3=P1^2; 
  24          sbit IN4=P1^0;
  25          sbit ENA=P1^4;    
  26          sbit ENB=P1^0;   
  27          
  28          //Ñ­¼£¿Ú Îå×éºìÍâ¶Ô¹Ü£¬ÒÀ´Î¶ÔÓ¦´Ó×óÍùÓÒµÚ1,2,3,4,5Îå×é
  29          sbit left1 =P3^6; 
  30          sbit left2 =P3^5;
  31          sbit mid3  =P3^4;
  32          sbit right4=P3^3;
  33          sbit right5=P3^2;
  34          
  35          void line_left();
  36          void line_right();
  37          void line_straight()reentrant;
  38          //----------------------------------------
  39          void delay(long int Delay_time)//ÑÓÊ±º¯Êý
  40           {
  41   1       uint t=Delay_time;
  42   1       while(t--);
  43   1       }
  44          //-----------------------------------------
  45          void init()      //¶¨Ê±Æ÷³õÊ¼»¯
  46           {
  47   1         left1=m0; //³õÊ¼»¯
  48   1         left2=m0;  //°×ÏßÎ»ÖÃ
  49   1         mid3 =m1;   //ºÚÏßÎ»ÖÃ
  50   1         right4=m0;
  51   1         right5=m0;
  52   1         TMOD|=0x01;
  53   1         TH0=(65536-66)/256;
  54   1         TL0=(65536-66)%256;
  55   1         EA=1;
C51 COMPILER V9.01   WU                                                                    09/11/2017 10:50:49 PAGE 2   

  56   1         ET0=1;
  57   1         TR0=1;
  58   1         ENA=1; //Ê¹ÄÜ¶Ë¿Ú£¬³õÊ¼»¯
  59   1         ENB=1; 
  60   1        }
  61          //--------------------------------------------
  62          void time0(void)interrupt 1      //ÖÐ¶Ï³ÌÐò
  63          {
  64   1        i++;                                          //µ÷ËÙÔÚÖÐ¶ÏÖÐÖ´ÐÐ
  65   1        j++;
  66   1        if(i<=Duty_left) 
  67   1           ENB=1;
  68   1        else ENB=0;  
  69   1        if(i>100) 
  70   1           {ENA=1;i=0;}
  71   1        if(j<=Duty_right) 
  72   1           ENA=1;
  73   1        else ENA=0;
  74   1        if(j>100) 
  75   1           {ENA=1;j=0;}
  76   1      TH0=(65536-66)/256;        //È¡Ô¼150HZ£¬12M¾§Õñ£¬Ã¿´Î¶¨Ê±66us,·Ö100´Î£¬ÕâÑù¿ªÍ·¶¨ÒåµÄ±äÁ¿ÕýºÃÖ±½Ó±íÊ¾Õ¼¿Õ±ÈµÄÊ
             -ýÖµ
  77   1      TL0=(65536-66)%256;
  78   1      }
  79          //-----------------------------------------------
  80          void correct_left()//Ïò×óÐ£Õý£¬¸³Öµ
  81           {
  82   1         Duty_left =correct_speed;
  83   1         Duty_right=full_speed_right;
  84   1         IN1=1;
  85   1         IN2=0;
  86   1         IN3=1;
  87   1         IN4=0;
  88   1       }
  89          //------------------------------------------------
  90           void correct_right()//ÏòÓÒÐ£Õý£¬¸³Öµ
  91           {
  92   1         Duty_left =full_speed_left;
  93   1         Duty_right=correct_speed;
  94   1         IN1=1;
  95   1         IN2=0;
  96   1         IN3=1;
  97   1         IN4=0;
  98   1       }
  99          //--------------------------------------------------
 100          void turn_left()//×ó×ª£¬¸³Öµ
 101          {
 102   1        Duty_left =turn_speed_left;
 103   1        Duty_right=turn_speed_right;
 104   1        IN1=1;         //×ªÍäÊ±Ò»¸öÕý×ª£¬Ò»¸ö·´×ª£¬
 105   1        IN2=0;
 106   1        IN3=0;
 107   1        IN4=1;                
 108   1      }
 109          //---------------------------------------------------
 110          void turn_right()//ÓÒ×ª£¬¸³Öµ
 111          {
 112   1        Duty_left =turn_speed_left;
 113   1        Duty_right=turn_speed_right;
 114   1        IN1=0;          //×ªÍäÊ±Ò»¸öÕý×ª£¬Ò»¸ö·´×ª£¬
 115   1        IN2=1;        
 116   1        IN3=1;        
C51 COMPILER V9.01   WU                                                                    09/11/2017 10:50:49 PAGE 3   

 117   1        IN4=0; 
 118   1      }
 119          //-----------------------------------------------------
 120          void straight() //Ö±×ß£¬¸³Öµ
 121          {
 122   1        Duty_left =full_speed_left;   //×óÓÒµç»úÕ¼¿Õ±È³õÊ¼»¯£¬µ÷½ÚÖ±ÏßÔË¶¯ËÙ¶È
 123   1        Duty_right=full_speed_right;  //¼øÓÚ×óÓÒÂÖµç»úÄÚ²¿×èÁ¦²»Í¬£¬¹ÊÕ¼¿Õ±ÈÈ¡²»Í¬Öµ£¬Õâ×éÖµÐèÒªµ¥¶ÀÐ´³ÌÐòÈ¡Öµ
 124   1        IN1=1;
 125   1        IN2=0;
 126   1        IN3=1;
 127   1        IN4=0; 
 128   1      }
 129          //-----------------------------------------------------
 130          void line_straight()reentrant //º¯ÊýÃûºó¼Óreentrant¿ÉÒÔµÝ¹éµ÷ÓÃ£¬//Ò»Ö±×ßºÚÖ±ÏßÊ±
 131          {
 132   1        straight();
 133   1        if(right5==m1){line_right();}
 134   1        else  
 135   1        if(left1==m1){line_left();}
 136   1        else
 137   1        if(left2==m1)                           //·ÀÖ¹Ð£ÕýÊ±£¬Ð¡³µ³å³ö¹ý´ó£¬µ¼ÖÂ2,4ºÅ¼ì²â¹ÜÆÁ±ÎÁËÁ½¶Ë¼ì²â¹ÜµÄ¼ì²â£¬±ÜÃâÆä×ßÖ±ÏßÊ±³ö¹ì
 138   1          while(left2==m1)
 139   1           {correct_left();
 140   2             if(right5==m1)
 141   2                {
 142   3                         line_right();
 143   3                         goto label3;
 144   3                         }
 145   2                 else if(left1==m1)
 146   2                       {line_left();
 147   3                   goto label3;}
 148   2           }
 149   1        else 
 150   1        if(right4==m1)                           //·ÀÖ¹Ð£ÕýÊ±£¬Ð¡³µ³å³ö¹ý´ó£¬µ¼ÖÂ2,4ºÅ¼ì²â¹ÜÆÁ±ÎÁËÁ½¶Ë¼ì²â¹ÜµÄ¼ì²â£¬±ÜÃâÆä×ßÖ±ÏßÊ±³ö¹
             -ì
 151   1         while(right4==m1)
 152   1          {correct_right();
 153   2           if(right5==m1)
 154   2             { line_right();  goto label3;}
 155   2           else if(left1==m1)
 156   2                      {line_left();goto label3;}
 157   2              }
 158   1        else
 159   1        if((left1==m0)&&(left2==m0)&&(mid3==m0)&&(right4==m0)&&(right5==m0))
 160   1          {
 161   2                straight();
 162   2                //delay(lenth);
 163   2                while(right4==m0) //±¾À´Ó¦¸ÃÊÇÓÃmid3,µ«ÊÇÎªÁËÌá¸ßÁéÃô¶È£¬Ñ¡Ôñright4£»Ïò×óÊ±£¬¿ÉÈ¡left2¶Ô¹Ü
 164   2                  {turn_right();}
 165   2                if(mid3==m1)
 166   2                  {line_straight();}
 167   2              
 168   2              }
 169   1      
 170   1              label3: ; //Ê²Ã´¶¼²»×ö
 171   1      }
 172          //-------------------------------------------------------------------------
 173          void line_right() //ÓÒ±ßÓÐºÚÏßÊ±
 174          {
 175   1              straight();//ÕâÀïµÄÖ±×ßÊÇÔÚ²»¹ÜºìÍâ¼ì²â½á¹ûµÄÖ±ÐÐ
 176   1              delay(lenth);
 177   1              if(mid3==m1)
C51 COMPILER V9.01   WU                                                                    09/11/2017 10:50:49 PAGE 4   

 178   1              {
 179   2                turn_right();//Ö´ÐÐÏòÓÒ×ªµÄ¸³Öµ
 180   2      label:delay(width);     //ÓÉwidthÖµ¾ö¶¨×ªÍäÊ±mid3¾­¹ýºÚÏß¿í¶ÈÊ±ËùÐèÒªµÄÊ±¼ä
 181   2                if(mid3==m0)
 182   2                  while(right4==m0)
 183   2                   {}
 184   2                else
 185   2                        goto label;
 186   2                      
 187   2               }
 188   1      
 189   1              else
 190   1              if(mid3==m0)
 191   1                 {
 192   2                   turn_right();
 193   2                   while(right4==m0)
 194   2                     {}       
 195   2                   if(midr==m1)
 196   2                     {line_straight();}
 197   2             }                 
 198   1      }
 199          //-----------------------------------------------------------------
 200          void line_left() //×ó±ß³öÏÖºÚÏßÊ±
 201          { 
 202   1        while(left1==m1)
 203   1        {
 204   2              if(right5==m1) 
 205   2              {
 206   3              line_right();
 207   3              goto label2;
 208   3              } 
 209   2         }
 210   1      
 211   1         delay(check_right);//×ó±ßÓöµ½ºÚÏßÊ±£¬×ó±ß³öÁËºÚÏßÖ®ºó£¬¼ÌÐøÑÓÊ±Ò»¶ÎÊ±¼ä£¬ÅÐ¶ÏÓÒ±ßÊÇ·ñÓöµ½ºÚÏß£¬
 212   1                                 //ÈôÓöµ½ºÚÏß£¬Ö´ÐÐline_right()º¯Êý
 213   1              if(right5==m1) 
 214   1              {
 215   2              line_right();
 216   2              goto label2;
 217   2              }
 218   1      
 219   1         if((mid3==m1)||(left2==m1)||(right4==m1)){line_straight();}
 220   1                else
 221   1                {
 222   2                   while(left2==m0)
 223   2                          {turn_left();}
 224   2                   if(midl==m1)
 225   2                      line_straight();    
 226   2                }
 227   1      label2: ;
 228   1      }
 229          //--------------------------------------------------------------------
 230          void detect_infrared() //Ñ­¼££¬ºìÍâ¼ì²â
 231           { 
 232   1         if(right5==m1){line_right();}
 233   1         else 
 234   1         if(left1==m1){line_left();}
 235   1         else
 236   1         if(left2==m1){correct_left();}
 237   1         else
 238   1         if(right4==m1){correct_right();}
 239   1         else
C51 COMPILER V9.01   WU                                                                    09/11/2017 10:50:49 PAGE 5   

 240   1         line_straight();
 241   1       }
 242          //--------------------------------------
 243          void main(void)//Ö÷³ÌÐò²¿·Ö
 244          {
 245   1        init();
 246   1        while(1)      //Ñ­»·¼ì²âºìÍâ¶Ô¹Ü²É¼¯µÄµçÆ½ÐÅºÅ
 247   1         {detect_infrared();}
 248   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    422    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
